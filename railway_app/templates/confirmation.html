{% extends 'base.html' %}
{% block title %}Booking Confirmed - Railway Ticket System{% endblock %}

{% block content %}
<div class="container py-5">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <!-- Success Message -->
            <div class="card border-success mb-4">
                <div class="card-body text-center p-5">
                    <div class="mb-4">
                        <i class="bi bi-check-circle-fill text-success" style="font-size: 4rem;"></i>
                    </div>
                    <h2 class="card-title text-success mb-3">Booking Confirmed!</h2>
                    <p class="card-text lead mb-4">Your ticket has been successfully booked. A confirmation email has been sent to your registered email address.</p>
                    
                    <div class="row justify-content-center">
                        <div class="col-md-6">
                            <div class="card bg-light">
                                <div class="card-body">
                                    <h5 class="card-title">PNR Number</h5>
                                    <h3 class="text-primary mb-0">{{ booking.pnr }}</h3>
                                    <small class="text-muted">Keep this PNR for future reference</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Booking Details -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="bi bi-info-circle"></i> Booking Details</h5>
                </div>
                <div class="card-body">
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Passenger Name:</strong><br>
                            {{ booking.passenger_name }}
                        </div>
                        <div class="col-md-6">
                            <strong>Email:</strong><br>
                            {{ booking.passenger_email }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Phone:</strong><br>
                            {{ booking.passenger_phone }}
                        </div>
                        <div class="col-md-6">
                            <strong>Age & Gender:</strong><br>
                            {{ booking.passenger_age }} / {{ booking.get_passenger_gender_display }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Journey Date:</strong><br>
                            {{ booking.journey_date|date:"l, d F Y" }}
                        </div>
                        <div class="col-md-6">
                            <strong>Seat Class:</strong><br>
                            {{ booking.get_seat_class_display }}
                        </div>
                    </div>
                    
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <strong>Booking Date:</strong><br>
                            {{ booking.booking_date|date:"d/m/Y H:i" }}
                        </div>
                        <div class="col-md-6">
                            <strong>Status:</strong><br>
                            <span class="badge bg-success">{{ booking.get_status_display }}</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Journey Details -->
            <div class="card mb-4">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="bi bi-train-front"></i> Journey Details</h5>
                </div>
                <div class="card-body">
                    {% for leg in booking.legs.all %}
                    <div class="border-bottom pb-3 mb-3 {% if not forloop.last %}border-bottom{% endif %}">
                        <div class="row align-items-center">
                            <div class="col-md-3 text-center">
                                <h6 class="text-muted mb-1">{{ leg.route.source.code }}</h6>
                                <small class="text-muted">{{ leg.route.source.name }}</small>
                            </div>
                            
                            <div class="col-md-6">
                                <div class="text-center">
                                    <strong>{{ leg.route.train.train_number }}</strong>
                                    <p class="small text-muted mb-1">{{ leg.route.train.train_name }}</p>
                                    <small class="text-muted">{{ leg.route.train.get_train_type_display }}</small>
                                </div>
                            </div>
                            
                            <div class="col-md-3 text-center">
                                <h6 class="text-muted mb-1">{{ leg.route.destination.code }}</h6>
                                <small class="text-muted">{{ leg.route.destination.name }}</small>
                            </div>
                        </div>
                        
                        <div class="row mt-3">
                            <div class="col-md-4">
                                <strong>Departure:</strong><br>
                                {{ leg.schedule.departure_time|time:"H:i" }}
                            </div>
                            <div class="col-md-4">
                                <strong>Arrival:</strong><br>
                                {{ leg.schedule.arrival_time|time:"H:i" }}
                            </div>
                            <div class="col-md-4">
                                <strong>Seat:</strong><br>
                                {{ leg.seat_number }}
                            </div>
                        </div>
                        
                        <div class="row mt-2">
                            <div class="col-md-6">
                                <strong>Distance:</strong> {{ leg.route.distance }} km
                            </div>
                            <div class="col-md-6">
                                <strong>Fare:</strong> ₹{{ leg.leg_fare }}
                            </div>
                        </div>
                    </div>
                    {% if not forloop.last %}
                    <div class="text-center my-3">
                        <span class="badge bg-warning text-dark">Connection</span>
                    </div>
                    {% endif %}
                    {% endfor %}
                </div>
            </div>

            <!-- Fare Summary -->
            <div class="card mb-4">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="bi bi-receipt"></i> Fare Summary</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <strong>Total Fare:</strong>
                        </div>
                        <div class="col-md-6 text-end">
                            <strong class="text-success" style="font-size: 1.2rem;">₹{{ booking.total_fare }}</strong>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="text-center">
                <a href="{% url 'download_ticket' booking.pnr %}" class="btn btn-primary btn-lg me-3">
                    <i class="bi bi-download"></i> Download Ticket (PDF)
                </a>
                <a href="{% url 'my_bookings' %}" class="btn btn-outline-primary btn-lg">
                    <i class="bi bi-list"></i> View My Bookings
                </a>
            </div>
            
            <!-- Important Notes -->
            <div class="alert alert-info mt-4" role="alert">
                <h6 class="alert-heading"><i class="bi bi-info-circle"></i> Important Information</h6>
                <ul class="mb-0">
                    <li>Please arrive at the station at least 30 minutes before departure</li>
                    <li>Carry a valid ID proof for verification</li>
                    <li>Cancellation charges apply as per railway rules</li>
                    <li>For any queries, contact customer support</li>
                </ul>
            </div>
        </div>
    </div>
</div>
{% endblock %}
